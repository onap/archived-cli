# Copyright Â© Intel Corporation 2019
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

open_cli_schema_version: 1.0
name: service-create
description: Create a service instance using SO

info:
  product: onap-elalto
  service: so
  author: ONAP CLI Team onap-discuss@lists.onap.org

parameters:
  - name: model-invariant-id
    description: model invariant id generated by ASDC.
    type: string
    short_option: e
    long_option: model-invariant-id
    is_optional: false
  - name: model-uuid
    description: model uuid generated by ASDC.
    type: string
    short_option: g
    long_option: model-uuid
    is_optional: false
  - name: model-name
    description: model name as provided in ASDC design time.
    type: string
    short_option: i
    long_option: model-name
    is_optional: false
  - name: model-version
    description: model-version
    type: string
    short_option: j
    long_option: model-version
    is_optional: false
  - name: model-version-id
    description: model-version-id
    type: string
    short_option: n
    long_option: model-version-id
    is_optional: false
  - name: customer
    description: unique id for customer
    type: string
    short_option: c
    long_option: customer
    is_optional: false
  - name: requestor-id
    description: requestor ID
    type: string
    short_option: q
    long_option: requestor-id
    is_optional: false
  - name: instance-name
    description: service instance name
    type: string
    short_option: k
    long_option: instance-name
    is_optional: false
  - name: supress-rollback
    description: rollback changes if instantiation fails.
    type: bool
    short_option: r
    long_option: supress-rollback
    is_optional: true
  - name: service-type
    description: subscription service type
    type: string
    short_option: w
    long_option: service-type
    is_optional: false
  - name: ala-carte
    description: ala carte flag, defaults to true
    type: string
    short_option: A
    long_option: ala-carte
    is_optional: true
    default_value: true
  - name: customer-latitude
    description: customer latitude, part of customer location
    type: string
    short_option: la
    long_option: customer-latitude
    is_optional: true
  - name: customer-longitude
    description: customer longitude, part of customer location
    type: string
    short_option: lo
    long_option: customer-longitude
    is_optional: true
  - name: customer-name
    description: customer name, part of customer location
    type: string
    short_option: y
    long_option: customer-name
    is_optional: true
  - name: homing-solution
    description: homing solution to use [oof|sniro]
    type: string
    short_option: H
    long_option: homing-solution
    is_optional: true
  - name: orchestrator
    description: orchestrator to use [multicloud|openstack(default)]
    type: string
    short_option: o
    long_option: orchestrator
    is_optional: true
  - name: api
    description: api to use [GR_API|VNF_API]
    type: string
    short_option: P
    long_option: api
    is_optional: true
    default_value: GR_API
  - name: subscriber-name
    description: subscriber name
    type: string
    short_option: S
    long_option: subscriber-name
    is_optional: true
  - name: project-name
    description: project name
    type: string
    short_option: x
    long_option: project-name
    is_optional: true
  - name: owning-entity-id
    description: owning entity id
    type: string
    short_option: z
    long_option: owning-entity-id
    is_optional: true
  - name: owning-entity-name
    description: owning entity name
    type: string
    short_option: O
    long_option: owning-entity-name
    is_optional: true

results:
  direction: portrait
  attributes:
    - name: service-id
      description: instance id for the created service.
      type: string
      scope: short
http:
  service:
    name: so
    version: v6
    auth: basic
    mode: direct
  request:
    uri: /onap/so/infra/serviceInstantiation/v7/serviceInstances
    method: POST
    headers:
      X-TransactionId: $s{uuid} 

    body: '{
              "requestDetails":{
                 "modelInfo":{
                    "modelType":"service",
                    "modelInvariantId":"${model-invariant-id}",
                    "modelUuid":"${model-uuid}",
                    "modelName":"${model-name}",
                    "modelVersion":"${model-version}",
                    "modelVersionId":"${model-version-id}",
                    "modelInvariantUuid" : "${model-invariant-id}"
                 },
                 "subscriberInfo":{
                    "globalSubscriberId":"${customer}",
                    "subscriberName":"${subscriber-name}"
                 },
                 "requestInfo":{
                    "requestorId":"${requestor-id}",
                    "instanceName":"${instance-name}",
                    "source":"CLI",
                    "suppressRollback":"${supress-rollback}"
                 },
                 "requestParameters":{
                    "subscriptionServiceType":"${service-type}",
                    "aLaCarte":"${ala-carte}",
                    "testApi":"${api}",
                    "userParams":[
                       {
                          "name":"Customer_Location",
                          "value":{
                             "customerLatitude":"${customer-latitude}",
                             "customerLongitude":"${customer-longitude}",
                             "customerName":"${customer-name}"
                          }
                       },
                       {
                          "name":"Homing_Solution",
                          "value":"${homing-solution}"
                       },
                       {
                          "name":"orchestrator",
                          "value":"${orchestrator}"
                       }
                    ]
                 },
                 "project":{
                    "projectName":"${project-name}"
                 },
                 "owningEntity":{
                    "owningEntityId":"${owning-entity-id}",
                    "owningEntityName":"${owning-entity-name}"
                 }
              }
           }'

  success_codes:
    - 202
  result_map:
    service-id: $b{$.requestReferences.instanceId}
  sample_response:
    body: '{
              "requestReferences":{
                 "instanceId":"${instance-id}",
                 "requestId":"375ba428-65e7-4f2b-afb9-74735ac6bfd0"
              }
           }'
